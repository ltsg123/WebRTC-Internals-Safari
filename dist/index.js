!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}let t=!0,n=!0;function i(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function r(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);const a=e=>{const t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,a),r.apply(this,[e,a])};const a=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(n))return a.apply(this,arguments);const i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function a(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(t=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function s(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function o(){if("object"==typeof window){if(t)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function c(e,t){n&&console.warn(e+" is deprecated, please use "+t+" instead.")}function d(e){return"[object Object]"===Object.prototype.toString.call(e)}function l(e){return d(e)?Object.keys(e).reduce((function(t,n){const i=d(e[n]),r=i?l(e[n]):e[n],a=i&&!Object.keys(r).length;return void 0===r||a?t:Object.assign(t,{[n]:r})}),{}):e}function p(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((i=>{i.endsWith("Id")?p(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach((t=>{p(e,e.get(t),n)}))})))}function h(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const a=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)})),a.forEach((t=>{e.forEach((n=>{n.type===i&&n.trackId===t.id&&p(e,n,r)}))})),r}const u=o;function m(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"==typeof i.ideal?(e[r("min",n)]=i.ideal,t.optional.push(e),e={},e[r("max",n)]=i.ideal,t.optional.push(e)):(e[r("",n)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach((e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){let a=e.video.facingMode;a=a&&("object"==typeof a?a:{ideal:a});const s=t.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||s)){let t;if(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?t=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let s=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!s&&n.length&&t.includes("back")&&(s=n[n.length-1]),s&&(e.video.deviceId=a.exact?{exact:s.deviceId}:{ideal:s.deviceId}),e.video=i(e.video),u("chrome: "+JSON.stringify(e)),r(e)}))}e.video=i(e.video)}return u("chrome: "+JSON.stringify(e)),r(e)},a=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){r(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{i&&i(a(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return r(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(a(e))))))}}}function f(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function g(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const r=new Event("track");r.track=n.track,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)})),t.stream.getTracks().forEach((n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const r=new Event("track");r.track=n,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else r(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function y(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function C(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,i]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const r=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},a=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const i=function(e){n(a(r(e)))};return t.apply(this,[i,e])}return new Promise(((e,n)=>{t.apply(this,[function(t){e(a(r(t)))},n])})).then(n,i)}}function v(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>h(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),r(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>h(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,i;return this.getSenders().forEach((n=>{n.track===e&&(t?i=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?i=!0:n=t),t.track===e))),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function b(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),r.apply(this,arguments)}}function S(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return b(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function a(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[n.id];if(r)r.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=a(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>a(this,e)))}};e.RTCPeerConnection.prototype[t]=i[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const o=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=o.get.apply(this);return""===e.type?e:a(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function T(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}))}function _(e,t){r(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var R=Object.freeze({__proto__:null,shimMediaStream:f,shimOnTrack:g,shimGetSendersWithDtmf:y,shimGetStats:C,shimSenderReceiverGetStats:v,shimAddTrackRemoveTrackWithNative:b,shimAddTrackRemoveTrack:S,shimPeerConnection:T,fixNegotiationNeeded:_,shimGetUserMedia:m,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const i=n.video&&n.video.width,r=n.video&&n.video.height,a=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:a||3}},i&&(n.video.mandatory.maxWidth=i),r&&(n.video.mandatory.maxHeight=r),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function w(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){c("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function E(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function P(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,a]=arguments;return i.apply(this,[e||null]).then((e=>{if(t.version<53&&!r)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(r,a)}}function k(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function x(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),r(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function D(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){c("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function I(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function M(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const i=t.apply(this,arguments);if(n){const{sender:t}=i,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return i})}function L(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function O(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function A(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var N=Object.freeze({__proto__:null,shimOnTrack:E,shimPeerConnection:P,shimSenderGetStats:k,shimReceiverGetStats:x,shimRemoveStream:D,shimRTCDataChannel:I,shimAddTransceiver:M,shimGetParameters:L,shimCreateOffer:O,shimCreateAnswer:A,shimGetUserMedia:w,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}});function B(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function j(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function F(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};let o=function(e,t,n){const i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=o,o=function(e,t,n){const i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=o,o=function(e,t,n){const i=s.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=o}function U(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(z(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function z(e){return e&&void 0!==e.video?Object.assign({},e,{video:l(e.video)}):e}function G(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(c("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function V(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function J(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function q(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var W=Object.freeze({__proto__:null,shimLocalStreamsAPI:B,shimRemoteStreamsAPI:j,shimCallbacksAPI:F,shimGetUserMedia:U,shimConstraints:z,shimRTCIceServerUrls:G,shimTrackEventTransceiver:V,shimCreateOfferLegacy:J,shimAudioContext:q}),H={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){let t=e.substr(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){const t={};let n;const i=e.substr(e.indexOf(" ")+1).split(";");for(let e=0;e<i.length;e++)n=i[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substr(t+1,i-t-1),n.value=e.substr(i+1)):n.attribute=e.substr(t+1),n},t.parseSsrcGroup=function(e){const t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substr(6)},t.parseFingerprint=function(e){const t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],r=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substr(12),password:r.substr(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");for(let r=3;r<i.length;r++){const a=i[r],s=t.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){const i=t.parseRtpMap(s),r=t.matchPrefix(e,"a=fmtp:"+a+" ");switch(i.parameters=r.length?t.parseFmtp(r[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(t.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))})),n},t.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)}));let r=0;return n.codecs.forEach((e=>{e.maxptime>r&&(r=e.maxptime)})),r>0&&(i+="a=maxptime:"+r+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{i+=t.writeExtmap(e)})),i},t.parseRtpEncodingParameters=function(e){const n=[],i=t.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),o=s.length>0&&s[0].ssrc;let c;const d=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substr(17).split(" ").map((e=>parseInt(e,10)))));d.length>0&&d[0].length>1&&d[0][0]===o&&(c=d[0][1]),i.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:o,codecPayloadType:parseInt(e.parameters.apt,10)};o&&c&&(t.rtx={ssrc:c}),n.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:o,mechanism:a?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&o&&n.push({ssrc:o});let l=t.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=l}))),n},t.parseRtcpParameters=function(e){const n={},i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;const a=t.matchPrefix(e,"a=rtcp-mux");return n.mux=a.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return n=i[0].substr(7).split(" "),{stream:n[0],track:n[1]};const r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return r.length>0?(n=r[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substr(19),10)),isNaN(r)&&(r=65536);const a=t.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substr(12),10),protocol:n.fmt,maxMessageSize:r};const s=t.matchPrefix(e,"a=sctpmap:");if(s.length>0){const e=s[0].substr(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,i){let r;const a=void 0!==n?n:2;r=e||t.generateSessionId();return"v=0\r\no="+(i||"thisisadapterortc")+" "+r+" "+a+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const i=t.splitLines(e);for(let e=0;e<i.length;e++)switch(i[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[e].substr(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t}(H);var K=H.exports,$=e({__proto__:null,default:K},[H.exports]);function X(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),i=K.parseCandidate(e.candidate),r=Object.assign(n,i);return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,r(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function Y(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||r(e,"icecandidate",(e=>{if(e.candidate){const t=K.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function Q(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=K.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=K.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},i=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},r=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},a=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const r=K.matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i},s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=i(arguments[0]),t=r(e),n=a(arguments[0],e);let s;s=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>s}),this._sctp=o}return s.apply(this,arguments)}}function Z(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},r(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function ee(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function te(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function ne(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ie(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return n.apply(this,[e]);return("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}var re=Object.freeze({__proto__:null,shimRTCIceCandidate:X,shimRTCIceCandidateRelayProtocol:Y,shimMaxMessageSize:Q,shimSendThrowTypeError:Z,shimConnectionState:ee,removeExtmapAllowMixed:te,shimAddIceCandidateNullOrEmpty:ne,shimParameterlessSetLocalDescription:ie});function ae(e){return se[e]}!function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=o,r=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=i(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=i(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=i(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),c={browserDetails:r,commonShim:re,extractVersion:i,disableLog:a,disableWarnings:s,sdp:$};switch(r.browser){case"chrome":if(!R||!T||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),c;if(null===r.version)return n("Chrome shim can not determine version, not shimming."),c;n("adapter.js shimming chrome."),c.browserShim=R,ne(e,r),ie(e),m(e,r),f(e),T(e,r),g(e),S(e,r),y(e),C(e),v(e),_(e,r),X(e),Y(e),ee(e),Q(e,r),Z(e),te(e,r);break;case"firefox":if(!N||!P||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),c;n("adapter.js shimming firefox."),c.browserShim=N,ne(e,r),ie(e),w(e,r),P(e,r),E(e),D(e),k(e),x(e),I(e),M(e),L(e),O(e),A(e),X(e),ee(e),Q(e,r),Z(e);break;case"safari":if(!W||!t.shimSafari)return n("Safari shim is not included in this adapter release."),c;n("adapter.js shimming safari."),c.browserShim=W,ne(e,r),ie(e),G(e),J(e),F(e),B(e),j(e),V(e),U(e),q(e),X(e),Y(e),Q(e,r),Z(e),te(e,r);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});const se={open_graph:!1,stats_update_interval:1e3,container:null};window.RTC_INTERNALS__PARAMS=se;const oe=document.createElement("div");oe.hidden=!0,oe.className="webrtc-internals-body-out",document.body.appendChild(oe);const ce=document.createElement("div");ce.id="webrtc-internals-body",ce.className="webrtc-internals-body",ce.innerHTML='\n<p id="content-root"></p>\n<template id="td2-template"><td></td><td></td></template>\n<template id="summary-template"><td><details><summary></summary></details></td></template>\n<template id="container-template"><div></div><div><canvas></canvas></div></template>\n<template id="summary-span-template"><summary><span></span></summary></template>\n<template id="checkbox-template"><input type=checkbox checked></template>\n<template id="trth-template"><tbody><tr><th colspan=2></th></tr></tbody></template>\n<template id="td-colspan-template"><td colspan=2></td></template>\n<template id="time-event-template"><tbody><tr><th>Time</th><th class="update-log-header-event">Event</th></tr></tbody></template>\n<template id="dump-template">\n  <div>\n    <a>\n      <button>Download the PeerConnection updates and stats data</button>\n    </a>\n    <label>\n      <input type="checkbox">Compress result\n    </label>\n  </div>\n  <p>\n    <label>\n      <input type="checkbox">Enable diagnostic audio recordings\n    </label>\n  </p>\n  <p class="audio-diagnostic-dumps-info">A diagnostic audio recording is used for analyzing audio problems. It consists of several files and contains the audio played out to the speaker (output) and captured from the microphone (input). The data is saved locally. Checking this box will enable recordings of all ongoing input and output audio streams (including non-WebRTC streams) and for future audio streams. When the box is unchecked or this page is closed, all ongoing recordings will be stopped and this recording functionality disabled. Recording audio from multiple tabs is supported as well as multiple recordings from the same tab.</p>\n  <p>When enabling, select a base filename to which the following suffixes will be added:</p>\n  <div>&lt;base filename&gt;.&lt;render process ID&gt;.aec_dump.&lt;AEC dump recording ID&gt;</div>\n  <div>&lt;base filename&gt;.input.&lt;stream recording ID&gt;.wav</div>\n  <div>&lt;base filename&gt;.output.&lt;stream recording ID&gt;.wav</div>\n  <p class="audio-diagnostic-dumps-info">It is recommended to choose a new base filename each time the feature is enabled to avoid ending up with partially overwritten or unusable audio files.</p>\n  <p>\n    <label>\n      <input type="checkbox" disabled>Enable diagnostic packet and event recording\n    </label>\n  </p>\n  <p class="audio-diagnostic-dumps-info">A diagnostic packet and event recording can be used for analyzing various issues related to thread starvation, jitter buffers or bandwidth estimation. Two types of data are logged. First, incoming and outgoing RTP headers and RTCP packets are logged. These do not include any audio or video information, nor any other types of personally identifiable information (so no IP addresses or URLs). Checking this box will enable the recording for ongoing WebRTC calls and for future WebRTC calls. When the box is unchecked or this page is closed, all ongoing recordings will be stopped and this recording functionality will be disabled for future WebRTC calls. Recording in multiple tabs or multiple recordings in the same tab will cause multiple log files to be created. When enabling, a filename for the recording can be entered. The entered filename is used as a base, to which the following suffixes will be appended.</p>\n  <p>&lt;base filename&gt;_&lt;date&gt;_&lt;timestamp&gt;_&lt;render process ID&gt;_&lt;recording ID&gt;</p>\n  <p class="audio-diagnostic-dumps-info">If a file with the same name already exists, it will be overwritten. No more than 5 logfiles  will be created, and each of them is limited to 60MB of storage.  On Android these limits are 3 files of at most 10MB each.  When the limit is reached, the checkbox must be unchecked and  rechecked to resume logging.</p>\n</template>\n<template id="stats-template">\n  <div>\n    Read stats From:\n    <select id="statsSelectElement">\n    </select>\n    <p><b>Note:</b> computed stats are in []. Experimental stats are marked with an * at the end and do not show up in the getStats result.</p>\n    <p id="legacy-stats-warning"><b>Note:</b> the callback-based getStats API and many of its goog-prefixed values are non-standard and may be removed from the getStats() API in the future.</p>\n  </div>\n</template>\n',oe.appendChild(ce);const de=document.createElement("div");var le;de.innerText="WebRTC-Internals",de.className="webrtc-internals-switch",document.body.appendChild(de),de.onclick=()=>{oe.hidden=!oe.hidden},le=oe,se["container"]=le;const pe=document.createElement("style");function he(e){!function(e,t){if(!e){var n="Assertion failed";t&&(n=n+": "+t);var i=new Error(n);throw function(){return this}().traceAssertionsForTesting&&console.warn(i.stack),i}}(!1,e||"Unreachable code hit")}function ue(e){var t=document.getElementById(e);return t?function(e,t,n){return e instanceof t||he(n||"Value "+e+" is not a[n] "+(t.name||typeof t)),e}(t,HTMLElement):null}pe.innerHTML="\n/* Copyright 2013 The Chromium Authors\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file. */\n\n.webrtc-internals-body-out{\n  position: fixed;\n  background: white;\n  top: 0;\n  width: 100%;\n  left: 0;\n  height: 100%;\n  z-index: 10000;\n  max-width: 100vw;\n  min-height: 100vh;\n}\n\n.webrtc-internals-body{\n  overflow-y: auto;\n  background: white;\n  top: 0;\n  width: 100%;\n  left: 0;\n  height: 100%;\n  z-index: 10000;\n}\n\n.webrtc-internals-switch {\n  left: 0px; \n  bottom: 0px; \n  display: block;\n  position: fixed;\n  cursor: pointer;\n  color: #FFF;\n  background-color:  #07c160;\n  line-height: 1;\n  font-size: 0.8em;\n  padding: 0.61538462em 1.23076923em;\n  z-index: 10000;\n  border-radius: 0.30769231em;\n  box-shadow: 0 0 0.61538462em rgb(0 0 0 / 40%);\n}\n\n\n.peer-connection-dump-root {\n  font-size: 0.8em;\n  padding-bottom: 3px;\n}\n\n.update-log-container {\n  float: left;\n  width: 50em;\n  overflow: auto;\n}\n\n.update-log-failure {\n  background-color: #be2026;\n}\n\n.update-log-legacy-api-usage {\n  background-color: #fed14b;\n}\n\n.ssrc-info-block {\n  color: #999;\n  font-size: 0.8em;\n}\n\n.stats-graph-container {\n  clear: both;\n  margin: 0.5em 0 0.5em 0;\n}\n\n.stats-graph-sub-container {\n  float: left;\n  margin: 0.5em;\n}\n\n.stats-graph-sub-container > div {\n  float: left;\n}\n\n.stats-graph-sub-container > div:first-child {\n  float: none;\n}\n\n.stats-table-container {\n  float: left;\n  padding: 0 0 0 0;\n  overflow: auto;\n}\n\n.stats-table-container >div:first-child {\n  font-size: 0.8em;\n  font-weight: bold;\n  text-align: center;\n  padding: 0 0 1em 0;\n}\n\n.stats-table-active-connection {\n  font-weight: bold;\n}\n\nbody {\n  font-family: 'Lucida Grande', sans-serif;\n}\n\ntable {\n  border: none;\n  margin: 0 1em 1em 0;\n}\n\ntd {\n  border: none;\n  font-size: 0.8em;\n  padding: 0 1em 0.5em 0;\n  min-width: 10em;\n  word-break: break-all;\n}\n\ntable > tr {\n  vertical-align: top;\n}\n\nth {\n  border: none;\n  font-size: 0.8em;\n  padding: 0 0 0.5em 0;\n}\n\n.tab-head {\n  background-color: rgb(220, 220, 220);\n  margin: 10px 2px 0 2px;\n  text-decoration: underline;\n  cursor: pointer;\n  display: inline-block;\n  overflow: hidden;\n  width: 20em;\n  height: 3em;\n}\n\n.active-tab-head {\n  background-color: turquoise;\n  font-weight: bold;\n}\n\n.tab-body {\n  height: 100%;\n  overflow-y: auto;\n  border: 1px solid turquoise;\n  border-top-width: 3px;\n  padding: 0 10px 500px 10px;\n  display: none;\n}\n\n.active-tab-body {\n  display: block;\n}\n\n.user-media-request-div-class {\n  background-color: lightgray;\n  margin: 10px 0 10px 0;\n}\n\n.user-media-request-div-class > div {\n  margin: 5px 0 5px 0;\n}\n\n.audio-diagnostic-dumps-info {\n  max-width: 60em;\n}\n\ndetails[open] details summary {\n    background-color: rgb(220, 220, 220);\n}\n\n.peerconnection-deprecations {\n  font-weight: bold;\n}\n\n.candidategrid tr {\n    text-align: center;\n    word-break: break-word;\n}\n\n.candidategrid-active {\n  font-weight: bold;\n}\n\n.candidategrid-candidatepair {\n    background-color: #ccc;\n}\n\n.candidategrid-candidatepair td:first-of-type {\n    text-align: left;\n}\n\n.candidategrid-candidate {\n    background-color: #ddd;\n}\n\n.candidategrid-candidate td:first-of-type {\n    text-align: right;\n}\n\n#legacy-stats-warning {\n    display: none;\n}\n\n",document.head.appendChild(pe);class me{constructor(){this.UPDATE_LOG_ID_SUFFIX_="-update-log",this.UPDATE_LOG_CONTAINER_CLASS_="update-log-container",this.UPDATE_LOG_TABLE_CLASS="update-log-table"}addPeerConnectionUpdate(e,t){t.value&&"{}"!==JSON.stringify(t.value)||(t.value="");const n=this.ensureUpdateContainer_(e),i=document.createElement("tr");n.firstChild.appendChild(i);const r=new Date(parseFloat(t.time)),a=document.createElement("td");a.textContent=r.toLocaleString(),i.appendChild(a);let s=t.type;if(0===t.value.length){const e=document.createElement("td");return e.textContent=s,void i.appendChild(e)}if("icecandidate"===t.type||"addIceCandidate"===t.type){t.value instanceof RTCIceCandidate&&(t.value=t.value.candidate);const e=t.value.match(/(?: typ )(host|srflx|relay)/);e&&(s+=" ("+e[1]+")")}else if("createOfferOnSuccess"===t.type||"createAnswerOnSuccess"===t.type)this.setLastOfferAnswer_(n,t);else if("setLocalDescription"===t.type)t.value!==this.getLastOfferAnswer_(n)&&(s+=" (munged)");else if("setConfiguration"===t.type)e.firstChild.children[2].textContent=t.value;else if(["iceconnectionstatechange","connectionstatechange","signalingstatechange"].includes(t.type)){const n={iceconnectionstatechange:"iceconnectionstate",connectionstatechange:"connectionstate",signalingstatechange:"signalingstate"}[t.type],i=e.getElementsByClassName(n)[0],r=i.textContent.split(" => ").length;r<10?i.textContent+=" => "+t.value:10===r&&(i.textContent+=" ...")}const o=ue("summary-template").content.cloneNode(!0),c=o.querySelector("summary");c.textContent=s,i.appendChild(o);const d=document.createElement("pre");if(i.cells[1].childNodes[0].appendChild(d),("iceconnectionstatechange"===t.type&&"failed"===t.value||"connectionstatechange"===t.type&&"failed"===t.value||-1!==t.type.indexOf("OnFailure")||"addIceCandidateFailed"===t.type)&&d.parentElement.classList.add("update-log-failure"),"string"==typeof t.value&&-1!==t.value.indexOf(", sdp:")){const[e,n]=t.value.substr(6).split(", sdp:"),i=document.createElement("button");i.textContent="Copy description to clipboard",i.onclick=()=>{navigator.clipboard.writeText(JSON.stringify({type:e,sdp:n}))},d.appendChild(i);const r=n.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"));c.textContent+=' (type: "'+e+'", '+r.length+" sections)",r.forEach((e=>{const t=e.trim().split("\n"),n=t.filter((e=>e.startsWith("a=mid:"))).map((e=>e.substr(6)))[0],i=document.createElement("details");i.open=r.length<=10,i.textContent=t.slice(1).join("\n");const a=document.createElement("summary");a.textContent=t[0].trim()+" ("+(t.length-1)+" more lines)"+(n?" mid="+n:""),i.appendChild(a),d.appendChild(i)}))}else d.textContent=t.value}ensureUpdateContainer_(e){const t=e.id+this.UPDATE_LOG_ID_SUFFIX_;let n=ue(t);if(!n){const i=document.createElement("div");i.className=this.UPDATE_LOG_CONTAINER_CLASS_,e.appendChild(i),n=document.createElement("table"),n.className=this.UPDATE_LOG_TABLE_CLASS,n.id=t,n.border=1,i.appendChild(n),n.appendChild(ue("time-event-template").content.cloneNode(!0))}return n}setLastOfferAnswer_(e,t){e["data-lastofferanswer"]=t.value}getLastOfferAnswer_(e){return e["data-lastofferanswer"]}}const fe=[],ge={};window.userMediaRequests=fe,window.peerConnectionDataStore=ge;class ye{constructor(e){this.root_=document.createElement("details"),this.root_.className="peer-connection-dump-root",e.appendChild(this.root_);const t=document.createElement("summary");this.root_.appendChild(t),t.textContent="Create Dump";const n=document.createElement("div");this.root_.appendChild(n),n.appendChild(ue("dump-template").content.cloneNode(!0)),n.getElementsByTagName("a")[0].addEventListener("click",this.onDownloadData_.bind(this)),n.getElementsByTagName("input")[1].addEventListener("click",this.onAudioDebugRecordingsChanged_.bind(this)),n.getElementsByTagName("input")[2].addEventListener("click",this.onEventLogRecordingsChanged_.bind(this))}setAudioDebugRecordingsCheckbox(){this.root_.getElementsByTagName("input")[1].checked=!0}clearAudioDebugRecordingsCheckbox(){this.root_.getElementsByTagName("input")[1].checked=!1}setEventLogRecordingsCheckbox(){this.root_.getElementsByTagName("input")[2].checked=!0}clearEventLogRecordingsCheckbox(){this.root_.getElementsByTagName("input")[2].checked=!1}setEventLogRecordingsCheckboxMutability(e){if(this.root_.getElementsByTagName("input")[2].disabled=!e,!e){const e=this.root_.getElementsByTagName("label")[2];e.style="color:red;",e.textContent=" WebRTC event logging's state was set by a command line flag."}}async onDownloadData_(e){const t=this.root_.getElementsByTagName("input")[0].checked,n={getUserMedia:fe,PeerConnections:ge,UserAgent:navigator.userAgent},i=new Blob([JSON.stringify(n,null,1)],{type:"octet/stream"});let r;if(t){const e=new CompressionStream("gzip"),t=i.stream().pipeThrough(e),n=await new Response(t).blob();r=URL.createObjectURL(n);const a=document.createElement("a");return a.download="webrtc_internals_dump.gz",a.href=r,void a.click()}r=URL.createObjectURL(i);const a=this.root_.getElementsByTagName("a")[0];a.download="webrtc_internals_dump.txt",a.href=r}onAudioDebugRecordingsChanged_(){this.root_.getElementsByTagName("input")[1].checked?chrome.send("enableAudioDebugRecordings"):chrome.send("disableAudioDebugRecordings")}onEventLogRecordingsChanged_(){this.root_.getElementsByTagName("input")[2].checked?chrome.send("enableEventLogRecordings"):chrome.send("disableEventLogRecordings")}}class Ce{constructor(e,t){this.head=e,this.body=t}}class ve{constructor(e){this.root_=e,this.ACTIVE_TAB_HEAD_CLASS_="active-tab-head",this.ACTIVE_TAB_BODY_CLASS_="active-tab-body",this.TAB_HEAD_CLASS_="tab-head",this.TAB_BODY_CLASS_="tab-body",this.tabElements_={},this.headBar_=null,this.activeTabId_=null,this.initializeHeadBar_()}addTab(e,t){if(this.tabElements_[e])throw"Tab already exists: "+e;const n=document.createElement("span");n.className=this.TAB_HEAD_CLASS_,n.textContent=t,n.title=t,this.headBar_.appendChild(n),n.addEventListener("click",this.switchTab_.bind(this,e));const i=document.createElement("div");return i.className=this.TAB_BODY_CLASS_,i.id=e,this.root_.appendChild(i),this.tabElements_[e]=new Ce(n,i),this.activeTabId_||this.switchTab_(e),this.tabElements_[e].body}removeTab(e){this.tabElements_[e]&&(this.tabElements_[e].head.parentNode.removeChild(this.tabElements_[e].head),this.tabElements_[e].body.parentNode.removeChild(this.tabElements_[e].body),delete this.tabElements_[e],this.activeTabId_===e&&this.switchTab_(Object.keys(this.tabElements_)[0]))}switchTab_(e){this.activeTabId_&&this.tabElements_[this.activeTabId_]&&(this.tabElements_[this.activeTabId_].body.classList.remove(this.ACTIVE_TAB_BODY_CLASS_),this.tabElements_[this.activeTabId_].head.classList.remove(this.ACTIVE_TAB_HEAD_CLASS_)),this.activeTabId_=e,this.tabElements_[e]&&(this.tabElements_[e].body.classList.add(this.ACTIVE_TAB_BODY_CLASS_),this.tabElements_[e].head.classList.add(this.ACTIVE_TAB_HEAD_CLASS_))}initializeHeadBar_(){this.headBar_=document.createElement("div"),this.root_.appendChild(this.headBar_),this.headBar_.style.textAlign="center"}}function be(e){if("ssrc"!==e.type)return console.warn("Trying to get ssrc from non-ssrc report."),null;if(e.stats&&e.stats.values)for(let t=0;t<e.stats.values.length-1;t+=2)if("ssrc"===e.stats.values[t])return e.stats.values[t+1];return e.id}class Se{constructor(){this.streamInfoContainer_={},this.ATTRIBUTE_SEPARATOR_=/[\r,\n]/,this.FIELD_SEPARATOR_REGEX_=/ .*:/,this.SSRC_ATTRIBUTE_PREFIX_="a=ssrc:",this.SSRC_INFO_BLOCK_CLASS="ssrc-info-block"}addSsrcStreamInfo(e){const t=e.split(this.ATTRIBUTE_SEPARATOR_);for(let e=0;e<t.length;++e){if(0!==t[e].indexOf(this.SSRC_ATTRIBUTE_PREFIX_))continue;let n=t[e].search(this.FIELD_SEPARATOR_REGEX_);if(-1===n)continue;const i=t[e].substring(this.SSRC_ATTRIBUTE_PREFIX_.length,n);this.streamInfoContainer_[i]||(this.streamInfoContainer_[i]={});let r,a,s=t[e].substring(n+1);for(;s.length>0;)n=s.search(this.FIELD_SEPARATOR_REGEX_),-1===n&&(n=s.length),r=s.substring(0,s.indexOf(":")),a=s.substring(s.indexOf(":")+1,n),this.streamInfoContainer_[i][r]=a,s=s.substring(n+1)}}getStreamInfo(e){return this.streamInfoContainer_[e]}populateSsrcInfo(e,t){if(!this.streamInfoContainer_[t])return;let n;e.className=this.SSRC_INFO_BLOCK_CLASS;for(const i in this.streamInfoContainer_[t])n=document.createElement("div"),e.appendChild(n),n.textContent=i+":"+this.streamInfoContainer_[t][i]}}class Te{constructor(e){this.ssrcInfoManager_=e}addStatsReport(e,t){if("codec"===t.type)return;const n=this.ensureStatsTable_(e,t);if(["outbound-rtp","inbound-rtp"].includes(t.type)&&t.stats.values){let e=t.id+" ("+t.type;const i=t.stats.values.findIndex(((e,t)=>"mid"===e&&t%2==0));if(-1!==i){e+=", mid="+t.stats.values[i+1]}const r=t.stats.values.findIndex(((e,t)=>"rid"===e&&t%2==0));if(-1!==r){e+=", rid="+t.stats.values[r+1]}const a=t.stats.values.findIndex(((e,t)=>"[codec]"===e&&t%2==0));if(-1!==a){e+=", "+t.stats.values[a+1].split(" ")[0]}n.parentElement.firstElementChild.innerText=e+")"}t.stats&&this.addStatsToTable_(n,t.stats.timestamp,t.stats.values)}clearStatsLists(e){const t=ue(e.id+"-table-container");t&&(e.removeChild(t),this.ensureStatsTableContainer_(e))}ensureStatsTableContainer_(e){const t=e.id+"-table-container";let n=ue(t);if(!n){n=document.createElement("div"),n.id=t,n.className="stats-table-container";const i=document.createElement("div");i.textContent="Stats Tables",n.appendChild(i),e.appendChild(n)}return n}ensureStatsTable_(e,t){const n=e.id+"-table-"+t.id;let i=ue(n);if(!i){const r=this.ensureStatsTableContainer_(e),a=document.createElement("details");r.appendChild(a);const s=document.createElement("summary");s.textContent=t.id+" ("+t.type+")",a.appendChild(s),i=document.createElement("table"),a.appendChild(i),i.id=n,i.border=1,i.appendChild(ue("trth-template").content.cloneNode(!0)),i.rows[0].cells[0].textContent="Statistics "+t.id,"ssrc"===t.type&&(i.insertRow(1),i.rows[1].appendChild(ue("td-colspan-template").content.cloneNode(!0)),this.ssrcInfoManager_.populateSsrcInfo(i.rows[1].cells[0],be(t)))}return i}addStatsToTable_(e,t,n){const i=new Date(t);this.updateStatsTableRow_(e,"timestamp",i.toLocaleString());for(let t=0;t<n.length-1;t+=2)this.updateStatsTableRow_(e,n[t],n[t+1])}updateStatsTableRow_(e,t,n){const i=e.id+"-"+t;let r=ue(i);const a="stats-table-active-connection";if(!r){r=document.createElement("tr"),r.id=i,e.firstChild.appendChild(r);const n=ue("td2-template").content.cloneNode(!0);n.querySelector("td").textContent=t,r.appendChild(n)}r.cells[1].textContent=n,"googActiveConnection"===t&&(!0===n?e.parentElement.classList.add(a):e.parentElement.classList.remove(a))}}class _e{constructor(){this.record_={pid:-1,constraints:{},rtcConfiguration:[],stats:{},updateLog:[],url:""}}toJSON(){return this.record_}initialize(e,t,n,i){this.record_.pid=e,this.record_.url=t,this.record_.rtcConfiguration=n,this.record_.constraints=i}resetStats(){this.record_.stats={}}getDataSeries(e){return this.record_.stats[e]}setDataSeries(e,t){this.record_.stats[e]=t}addUpdate(e){const t=new Date(parseFloat(e.time));this.record_.updateLog.push({time:t.toLocaleString(),type:e.type,value:e.value})}}const Re=Object.freeze({kNone:Object.freeze({postfix:"",multiplier:1}),kMillisecondsFromSeconds:Object.freeze({postfix:"_in_ms",multiplier:1e3}),kBytesToBits:Object.freeze({bitrate:!0,multiplier:8})});class we{constructor(e,t){this.name=e,this.value=t}toString(){return'{"'+this.name+'":"'+this.value+'"}'}}class Ee{constructor(e){this.id=e,this.calculatedMetricsByOriginalName=new Map}addCalculatedMetric(e,t){let n=this.calculatedMetricsByOriginalName.get(e);n||(n=[],this.calculatedMetricsByOriginalName.set(e,n)),n.push(t)}getCalculatedMetrics(e){const t=this.calculatedMetricsByOriginalName.get(e);return t||[]}toString(){let e='{id:"'+this.id+'"';for(const t of this.calculatedMetricsByOriginalName.keys()){const n=this.calculatedMetricsByOriginalName.get(t);e+=","+t+":[";for(let t=0;t<n.length;t++)e+=n[t].toString(),t+1<n.length&&(e+=","),e+="]"}return e+="}",e}}class Pe{constructor(){this.statsById=new Map,this.calculatedStatsById=new Map}static fromInternalsReportList(e){const t=new Pe;return e.forEach((e=>{if(!e.stats||!e.stats.values)return;const n={id:e.id,type:e.type,timestamp:e.stats.timestamp/1e3},i=e.stats.values;for(let e=0;e<i.length;e+=2)n[i[e]]=i[e+1];t.statsById.set(n.id,n)})),t}toInternalsReportList(){const e=[];for(const t of this.statsById.values()){const n={id:t.id,type:t.type,stats:{timestamp:1e3*t.timestamp,values:[]}};Object.keys(t).forEach((e=>{if("id"===e||"type"===e||"timestamp"===e)return;n.stats.values.push(e),n.stats.values.push(t[e]);this.getCalculatedMetrics(t.id,e).forEach((e=>{n.stats.values.push(e.name),n.stats.values.push(e.value?e.value:0)}))})),e.push(n)}return e}toString(){let e="";for(const t of this.statsById.values())""!==e&&(e+=","),e+=JSON.stringify(t);let t="";for(const e of this.calculatedStatsById.values())""!==t&&(t+=","),t+=e.toString();return"[original:"+e+"],calculated:["+t+"]"}get(e){return this.statsById.get(e)}getByType(e){const t=[];for(const n of this.statsById.values())n.type===e&&t.push(n);return t}addCalculatedMetric(e,t,n,i){let r=this.calculatedStatsById.get(e);r||(r=new Ee(e),this.calculatedStatsById.set(e,r)),r.addCalculatedMetric(t,new we(n,i))}getCalculatedMetrics(e,t){const n=this.calculatedStatsById.get(e);return n?n.getCalculatedMetrics(t):[]}}class ke{constructor(e){this.metric=e}getCalculatedMetricName(){return"["+this.metric+"]"}calculate(e,t,n){const i=n.get(e)[this.metric];return new Date(i).toLocaleString()}}class xe{constructor(e,t,n=Re.kNone){this.accumulativeMetric=e,this.samplesMetric=t,this.modifier=n}getCalculatedMetricName(){const e=this.modifier.bitrate?this.accumulativeMetric+"_in_bits":this.accumulativeMetric;return"timestamp"===this.samplesMetric?"["+e+"/s]":"["+e+"/"+this.samplesMetric+this.modifier.postfix+"]"}calculate(e,t,n){return xe.calculateRate(e,t,n,this.accumulativeMetric,this.samplesMetric)*this.modifier.multiplier}static calculateRate(e,t,n,i,r){if(!t||!n)return;const a=t.get(e),s=n.get(e);if(!a||!s)return;if(s.timestamp-a.timestamp<=0)return;const o=Number(a[i]),c=Number(s[i]);if("number"!=typeof o||"number"!=typeof c)return;const d=Number(a[r]),l=Number(s[r]);if("number"!=typeof d||"number"!=typeof l)return;return(c-o)/(l-d)}}class De{getCalculatedMetricName(){return"[codec]"}calculate(e,t,n){const i=n.get(e),r=n.get(i.codecId);if(!r)return;const a=r.mimeType.substr(r.mimeType.indexOf("/")+1);let s="";return r.sdpFmtpLine&&(s=", "+r.sdpFmtpLine),a+" ("+r.payloadType+s+")"}}class Ie{getCalculatedMetricName(){return"[Audio_Level_in_RMS]"}calculate(e,t,n){const i=xe.calculateRate(e,t,n,"totalAudioEnergy","totalSamplesDuration");return Math.sqrt(i)}}class Me{constructor(e,...t){this.metricA=e,this.otherMetrics=t}getCalculatedMetricName(){return"["+this.metricA+"-"+this.otherMetrics.join("-")+"]"}calculate(e,t,n){const i=n.get(e);return parseInt(i[this.metricA],10)-this.otherMetrics.map((e=>parseInt(i[e],10))).reduce(((e,t)=>e+t),0)}}class Le{constructor(e,t,n,i){this.totalSquaredSumMetric=e,this.totalSumMetric=t,this.totalCount=n,this.label=i}getCalculatedMetricName(){return"["+this.label+"StDev_in_ms]"}calculate(e,t,n){return Le.calculateStandardDeviation(e,t,n,this.totalSquaredSumMetric,this.totalSumMetric,this.totalCount)}static calculateStandardDeviation(e,t,n,i,r,a){if(!t||!n)return;const s=t.get(e),o=n.get(e);if(!s||!o)return;const c=Number(o[a])-Number(s[a]);if(c<=0)return;const d=Number(s[i]),l=Number(o[i]);if("number"!=typeof d||"number"!=typeof l)return;const p=Number(s[r]),h=Number(o[r]);if("number"!=typeof p||"number"!=typeof h)return;const u=h-p,m=(l-d-Math.pow(u,2)/c)/c;return m<0?void 0:1e3*Math.sqrt(m)}}class Oe{constructor(){this.previousReport=null,this.currentReport=null,this.statsCalculators=[{type:"data-channel",metricCalculators:{messagesSent:new xe("messagesSent","timestamp"),messagesReceived:new xe("messagesReceived","timestamp"),bytesSent:new xe("bytesSent","timestamp",Re.kBytesToBits),bytesReceived:new xe("bytesReceived","timestamp",Re.kBytesToBits)}},{type:"media-source",metricCalculators:{totalAudioEnergy:new Ie}},{type:"track",metricCalculators:{framesSent:new xe("framesSent","timestamp"),framesReceived:[new xe("framesReceived","timestamp"),new Me("framesReceived","framesDecoded","framesDropped")],totalAudioEnergy:new Ie,jitterBufferDelay:new xe("jitterBufferDelay","jitterBufferEmittedCount",Re.kMillisecondsFromSeconds)}},{type:"outbound-rtp",metricCalculators:{bytesSent:new xe("bytesSent","timestamp",Re.kBytesToBits),headerBytesSent:new xe("headerBytesSent","timestamp",Re.kBytesToBits),packetsSent:new xe("packetsSent","timestamp"),totalPacketSendDelay:new xe("totalPacketSendDelay","packetsSent",Re.kMillisecondsFromSeconds),framesEncoded:new xe("framesEncoded","timestamp"),framesSent:new xe("framesSent","timestamp"),totalEncodedBytesTarget:new xe("totalEncodedBytesTarget","timestamp",Re.kBytesToBits),totalEncodeTime:new xe("totalEncodeTime","framesEncoded",Re.kMillisecondsFromSeconds),qpSum:new xe("qpSum","framesEncoded"),codecId:new De,retransmittedPacketsSent:new xe("retransmittedPacketsSent","timestamp"),retransmittedBytesSent:new xe("retransmittedBytesSent","timestamp",Re.kBytesToBits)}},{type:"inbound-rtp",metricCalculators:{bytesReceived:new xe("bytesReceived","timestamp",Re.kBytesToBits),headerBytesReceived:new xe("headerBytesReceived","timestamp",Re.kBytesToBits),packetsReceived:new xe("packetsReceived","timestamp"),framesReceived:[new xe("framesReceived","timestamp"),new Me("framesReceived","framesDecoded","framesDropped")],framesDecoded:new xe("framesDecoded","timestamp"),keyFramesDecoded:new xe("keyFramesDecoded","timestamp"),totalDecodeTime:new xe("totalDecodeTime","framesDecoded",Re.kMillisecondsFromSeconds),totalInterFrameDelay:new xe("totalInterFrameDelay","framesDecoded",Re.kMillisecondsFromSeconds),totalSquaredInterFrameDelay:new Le("totalSquaredInterFrameDelay","totalInterFrameDelay","framesDecoded","interFrameDelay"),totalSamplesReceived:new xe("totalSamplesReceived","timestamp"),concealedSamples:[new xe("concealedSamples","timestamp"),new xe("concealedSamples","totalSamplesReceived")],silentConcealedSamples:new xe("silentConcealedSamples","timestamp"),insertedSamplesForDeceleration:new xe("insertedSamplesForDeceleration","timestamp"),removedSamplesForAcceleration:new xe("removedSamplesForAcceleration","timestamp"),qpSum:new xe("qpSum","framesDecoded"),codecId:new De,totalAudioEnergy:new Ie,jitterBufferDelay:new xe("jitterBufferDelay","jitterBufferEmittedCount",Re.kMillisecondsFromSeconds),lastPacketReceivedTimestamp:new ke("lastPacketReceivedTimestamp"),estimatedPlayoutTimestamp:new ke("estimatedPlayoutTimestamp"),totalProcessingDelay:new xe("totalProcessingDelay","framesDecoded",Re.kMillisecondsFromSeconds),"totalAssemblyTime*":new xe("totalAssemblyTime*","framesAssembledFromMultiplePackets*",Re.kMillisecondsFromSeconds)}},{type:"remote-outbound-rtp",metricCalculators:{remoteTimestamp:new ke("remoteTimestamp")}},{type:"transport",metricCalculators:{bytesSent:new xe("bytesSent","timestamp",Re.kBytesToBits),bytesReceived:new xe("bytesReceived","timestamp",Re.kBytesToBits),packetsSent:new xe("packetsSent","timestamp"),packetsReceived:new xe("packetsReceived","timestamp")}},{type:"candidate-pair",metricCalculators:{bytesSent:new xe("bytesSent","timestamp",Re.kBytesToBits),bytesReceived:new xe("bytesReceived","timestamp",Re.kBytesToBits),packetsSent:new xe("packetsSent","timestamp"),packetsReceived:new xe("packetsReceived","timestamp"),totalRoundTripTime:new xe("totalRoundTripTime","responsesReceived")}}]}addStatsReport(e){this.previousReport=this.currentReport,this.currentReport=e,this.updateCalculatedMetrics_()}updateCalculatedMetrics_(){this.statsCalculators.forEach((e=>{this.currentReport.getByType(e.type).forEach((t=>{Object.keys(e.metricCalculators).forEach((n=>{let i=e.metricCalculators[n];Array.isArray(i)||(i=[i]),i.forEach((e=>{this.currentReport.addCalculatedMetric(t.id,n,e.getCalculatedMetricName(),e.calculate(t.id,this.previousReport,this.currentReport))}))}))}))}))}}function Ae(e,t,n){const i=document.createElement(t);return i.textContent=n,e.appendChild(i),i}function Ne(e,t,n){const i="grid-"+e+"-"+t+"-"+n;let r=document.getElementById(i);if(!r){r=document.createElement("tr"),r.id=i;for(let e=0;e<11;e++)r.appendChild(document.createElement("td"));ue("grid-"+e).appendChild(r)}return r}function Be(e,t,n,i){const r=Ne(e.id,n.id,"candidatepair");r.classList.add("candidategrid-candidatepair"),t&&r.classList.add("candidategrid-active"),r.children[0].innerText=n.id,r.children[1].innerText=n.state,r.children[5].innerText="0x"+parseInt(n.priority,10).toString(16),r.children[6].innerText=n.bytesSent+" / "+n.bytesReceived,r.children[7].innerText=n.requestsSent+" / "+n.responsesReceived,r.children[8].innerText=n.requestsReceived+" / "+n.responsesSent,r.children[9].innerText=void 0!==n.currentRoundTripTime?n.currentRoundTripTime+"s":"",r.children[10].innerText=(new Date).toLocaleTimeString();const a=Ne(e.id,n.id,"local");a.className="candidategrid-candidate";const s=i.get(n.localCandidateId);["id","type","address","port","candidateType","priority"].forEach(((e,t)=>{"candidateType"==e&&s.relayProtocol?a.children[t].innerText=s[e]+"("+s.relayProtocol+")":a.children[t].innerText="priority"===e?"0x"+parseInt(s[e],10).toString(16):s[e]})),r.children[2].innerText=s.networkType,r.children[4].innerText=s.protocol;const o=Ne(e.id,n.id,"remote");o.className="candidategrid-candidate";const c=i.get(n.remoteCandidateId);return["id","type","address","port","candidateType","priority"].forEach(((e,t)=>{o.children[t].innerText="priority"===e?"0x"+parseInt(c[e],10).toString(16):c[e]})),r}class je{constructor(e){this.dataPoints_=[],this.color_="red",this.isVisible_=!0,this.cacheStartTime_=null,this.cacheStepSize_=0,this.cacheValues_=[],this.statsType_=e}toJSON(){if(this.dataPoints_.length<1)return{};const e=[];for(let t=0;t<this.dataPoints_.length;++t)e.push(this.dataPoints_[t].value);return{startTime:this.dataPoints_[0].time,endTime:this.dataPoints_[this.dataPoints_.length-1].time,statsType:this.statsType_,values:JSON.stringify(e)}}addPoint(e,t){const n=new Date(e);this.dataPoints_.push(new Fe(n,t)),this.dataPoints_.length>1e3&&this.dataPoints_.shift()}isVisible(){return this.isVisible_}show(e){this.isVisible_=e}getColor(){return this.color_}setColor(e){this.color_=e}getCount(){return this.dataPoints_.length}getValues(e,t,n){return this.cacheStartTime_===e&&this.cacheStepSize_===t&&this.cacheValues_.length===n||(this.cacheValues_=this.getValuesInternal_(e,t,n),this.cacheStartTime_=e,this.cacheStepSize_=t),this.cacheValues_}getValuesInternal_(e,t,n){const i=[];let r=0,a=0,s=e;for(let e=0;e<n;++e){for(;r<this.dataPoints_.length&&this.dataPoints_[r].time<s;)a=this.dataPoints_[r].value,++r;i[e]=a,s+=t}return i}}class Fe{constructor(e,t){this.time=e,this.value=t}}const Ue="#CCC",ze="#000";class Ge{constructor(e,t){this.scrollbar_={position_:0,range_:0},this.graphDiv_=ue(e),this.canvas_=ue(t),this.startTime_=0,this.endTime_=1,this.graph_=null,this.scale_=1e3,this.updateScrollbarRange_(!0)}setScale(e){this.scale_=e}getLength_(){const e=this.endTime_-this.startTime_;return Math.floor(e/this.scale_)}graphScrolledToRightEdge_(){return this.scrollbar_.position_===this.scrollbar_.range_}updateScrollbarRange_(e){let t=this.getLength_()-this.canvas_.width;t<0&&(t=0),this.scrollbar_.position_>t&&(e=!0),this.scrollbar_.range_=t,e&&(this.scrollbar_.position_=t,this.repaint())}setDateRange(e,t){this.startTime_=e.getTime(),this.endTime_=t.getTime(),this.endTime_<=this.startTime_&&(this.startTime_=this.endTime_-1),this.updateScrollbarRange_(!0)}updateEndDate(e){this.endTime_=e||(new Date).getTime(),this.updateScrollbarRange_(this.graphScrolledToRightEdge_())}getStartDate(){return new Date(this.startTime_)}setDataSeries(e){this.graph_=new Ve;for(let t=0;t<e.length;++t)this.graph_.addDataSeries(e[t]);this.repaint()}addDataSeries(e){this.graph_||(this.graph_=new Ve),this.graph_.addDataSeries(e),this.repaint()}repaint(){if(null===this.canvas_.offsetParent)return;this.repaintTimerRunning_=!1;const e=this.canvas_.width;let t=this.canvas_.height;const n=this.canvas_.getContext("2d");n.fillStyle="#FFF",n.fillRect(0,0,e,t);const i=n.font.match(/([0-9]+)px/)[1],r=parseInt(i);if(0===i.length||r<=0||4*r>t||e<50)return;n.save(),n.translate(.5,.5);let a=this.scrollbar_.position_;0===this.scrollbar_.range_&&(a=this.getLength_()-this.canvas_.width);const s=this.startTime_+a*this.scale_,o=t;t-=r+4,this.drawTimeLabels(n,e,t,o,s),n.strokeStyle=Ue,n.strokeRect(0,0,e-1,t-1),this.graph_&&(this.graph_.layout(e,t,r,s,this.scale_),this.graph_.drawTicks(n),this.graph_.drawLines(n),this.graph_.drawLabels(n)),n.restore()}drawTimeLabels(e,t,n,i,r){const a=6e4;let s=Math.ceil(r/a)*a;for(e.textBaseline="bottom",e.textAlign="center",e.fillStyle=ze,e.strokeStyle=Ue;;){const o=Math.round((s-r)/this.scale_);if(o>=t)break;const c=new Date(s).toLocaleTimeString();e.fillText(c,o,i),e.beginPath(),e.lineTo(o,0),e.lineTo(o,n),e.stroke(),s+=a}}getDataSeriesCount(){return this.graph_?this.graph_.dataSeries_.length:0}hasDataSeries(e){return!!this.graph_&&this.graph_.hasDataSeries(e)}}class Ve{constructor(){this.dataSeries_=[],this.width_=0,this.height_=0,this.fontHeight_=0,this.startTime_=0,this.scale_=0,this.min_=0,this.max_=0,this.labels_=[]}addDataSeries(e){this.dataSeries_.push(e)}hasDataSeries(e){for(let t=0;t<this.dataSeries_.length;++t)if(this.dataSeries_[t]===e)return!0;return!1}getValues(e){return e.isVisible()?e.getValues(this.startTime_,this.scale_,this.width_):null}layout(e,t,n,i,r){this.width_=e,this.height_=t,this.fontHeight_=n,this.startTime_=i,this.scale_=r;let a=0,s=0;for(let e=0;e<this.dataSeries_.length;++e){const t=this.getValues(this.dataSeries_[e]);if(t)for(let e=0;e<t.length;++e)t[e]>a?a=t[e]:t[e]<s&&(s=t[e])}this.layoutLabels_(s,a)}layoutLabels_(e,t){if(t-e<1024)return void this.layoutLabelsBasic_(e,t,3);const n=["","k","M","G","T","P"];let i=1;for(e/=1024,t/=1024;n[i+1]&&t-e>=1024;)e/=1024,t/=1024,++i;this.layoutLabelsBasic_(e,t,3);for(let e=0;e<this.labels_.length;++e)this.labels_[e]+=" "+n[i];this.min_*=Math.pow(1024,i),this.max_*=Math.pow(1024,i)}layoutLabelsBasic_(e,t,n){this.labels_=[];const i=t-e;if(0===i)return void(this.min_=this.max_=t);const r=2*this.fontHeight_+4;let a=1+this.height_/r;a<2?a=2:a>6&&(a=6);let s=Math.pow(10,-n),o=n;for(;!(Math.ceil(i/s)+1<=a);){if(Math.ceil(i/(2*s))+1<=a){s*=2;break}if(Math.ceil(i/(5*s))+1<=a){s*=5;break}s*=10,o>0&&--o}this.max_=Math.ceil(t/s)*s,this.min_=Math.floor(e/s)*s;for(let e=this.max_;e>=this.min_;e-=s)this.labels_.push(e.toFixed(o))}drawTicks(e){const t=this.width_-1,n=this.width_-1-10;e.fillStyle=Ue,e.beginPath();for(let i=1;i<this.labels_.length-1;++i){const r=Math.round(this.height_*i/(this.labels_.length-1));e.moveTo(t,r),e.lineTo(n,r)}e.stroke()}drawLines(e){let t=0;const n=this.height_-1;this.max_&&(t=n/(this.max_-this.min_));for(let i=this.dataSeries_.length-1;i>=0;--i){const r=this.getValues(this.dataSeries_[i]);if(r){e.strokeStyle=this.dataSeries_[i].getColor(),e.beginPath();for(let i=0;i<r.length;++i)e.lineTo(i,n-Math.round((r[i]-this.min_)*t));e.stroke()}}}drawLabels(e){if(0===this.labels_.length)return;const t=this.width_-3;e.fillStyle=ze,e.textAlign="right",e.textBaseline="top",e.fillText(this.labels_[0],t,0),e.textBaseline="bottom";const n=(this.height_-1)/(this.labels_.length-1);for(let i=1;i<this.labels_.length;++i)e.fillText(this.labels_[i],t,n*i)}}const Je="stats-graph-container-heading",qe="googReceivedPacketGroupPropagationDeltaDebug",We="googReceivedPacketGroupArrivalTimeDebug",He={googAvailableSendBandwidth:{color:"red"},googTargetEncBitrateCorrected:{color:"purple"},googActualEncBitrate:{color:"orange"},googRetransmitBitrate:{color:"blue"},googTransmitBitrate:{color:"green"}},Ke=function(e){const t=e.dataPoints_.length;if(t>=2){const n=e.dataPoints_[t-1],i=e.dataPoints_[t-2];return Math.floor(1e3*(n.value-i.value)/(n.time-i.time))}return 0},$e=function(e){return 8*Ke(e)},Xe={packetsSent:{convertedName:"packetsSentPerSecond",convertFunction:Ke},bytesSent:{convertedName:"bitsSentPerSecond",convertFunction:$e},packetsReceived:{convertedName:"packetsReceivedPerSecond",convertFunction:Ke},bytesReceived:{convertedName:"bitsReceivedPerSecond",convertFunction:$e},googTargetEncBitrate:{convertedName:"googTargetEncBitrateCorrected",convertFunction(e){const t=e.dataPoints_.length,n=e.dataPoints_[t-1];return n.value<5e3?1e3*n.value:n.value}}},Ye={ssrc:!0,googTrackId:!0,googComponent:!0,googLocalAddress:!0,googRemoteAddress:!0,googFingerprint:!0};function Qe(e){return"codec"===e.type||("data-channel"===e.type&&"connecting"===Ze(e,"state")||("transport"===e.type&&"new"===Ze(e,"dtlsState")||("local-candidate"===e.type||"remote-candidate"===e.type)))}function Ze(e,t){const n=e.stats.values;for(let e=0;e<n.length;e+=2)if(n[e]===t)return n[e+1]}function et(e,t){return"data-channel"===e.type&&"datachannelid"===t||("candidate-pair"===e.type&&"priority"===t||!(!["inbound-rtp","outbound-rtp"].includes(e.type)||!["mid","rid"].includes(t)))}const tt={};window.graphViews=tt;const nt=new Map;function it(e,t){return Ye[e]||isNaN(t)?NaN:parseFloat(t)}function rt(e,t,n){const i=t.type,r=t.id,a=t.stats;if(!a||!a.values)return;const s=e.hasChildNodes()?Array.from(e.childNodes):[];for(let s=0;s<a.values.length-1;s+=2){const o=a.values[s];if(o===qe){st(e,t,a.values[s+1]);continue}const c=r+"-"+o,d=it(o,a.values[s+1]);if(isNaN(d)){at(e,i,c,o,[a.timestamp],[a.values[s+1]]);continue}let l=c,p=o,h=d;if(n&&Xe[o]&&(at(e,i,c,o,[a.timestamp],[d]),h=Xe[o].convertFunction(ge[e.id].getDataSeries(c)),p=Xe[o].convertedName,l=r+"-"+p),at(e,i,l,p,[a.timestamp],[h]),!n&&(Qe(t)||et(t,o)))continue;const u=He[p]?"bweCompound":p,m=e.id+"-"+r+"-"+u;if(!tt[m]){tt[m]=ot(e,t,u);const n=new URLSearchParams(window.location.search);if(n.has("statsInterval")){const e=Math.max(parseInt(n.get("statsInterval"),10),100);isFinite(e)&&tt[m].setScale(e)}const i=new Date(a.timestamp);tt[m].setDateRange(i,i)}const f=ge[e.id].getDataSeries(l);tt[m].hasDataSeries(f)||tt[m].addDataSeries(f),tt[m].updateEndDate()}const o=e.hasChildNodes()?Array.from(e.childNodes):[];for(let t=0;t<o.length;++t)if(!s.includes(o[t])){let n=nt.get(e.id);n||(n=[],nt.set(e.id,n)),n.push(o[t])}}function at(e,t,n,i,r,a){let s=ge[e.id].getDataSeries(n);s||(s=new je(t),ge[e.id].setDataSeries(n,s),He[i]&&s.setColor(He[i].color));for(let e=0;e<r.length;++e)s.addPoint(r[e],a[e])}function st(e,t,n){const i=t.id,r=t.stats;let a=null;for(let e=0;e<r.values.length-1;e+=2)if(r.values[e]===We){a=r.values[e+1];break}if(null==a)return;try{n=JSON.parse(n),a=JSON.parse(a)}catch(e){return void console.log(e)}const s=i+"-"+qe;at(e,"test type",s,qe,a,n);const o=e.id+"-"+i+"-"+qe,c=new Date(a[a.length-1]);if(!tt[o]){tt[o]=ot(e,t,qe),tt[o].setScale(10),tt[o].setDateRange(c,c);const n=ge[e.id].getDataSeries(s);tt[o].addDataSeries(n)}tt[o].updateEndDate(c)}function ot(e,t,n){const i=function(e,t){const n=e.id+"-"+t.type+"-"+t.id+"-graph-container";let i=ue(n);if(!i){i=document.createElement("details"),i.id=n,i.className="stats-graph-container",e.appendChild(i),i.appendChild(ue("summary-span-template").content.cloneNode(!0)),i.firstChild.firstChild.className=Je,i.firstChild.firstChild.textContent="Stats graphs for "+t.id+" ("+t.type+")";const r=function(e){if("ssrc"!==e.type)return"";if(e.stats&&e.stats.values){if(-1!==e.stats.values.indexOf("audioOutputLevel")||-1!==e.stats.values.indexOf("audioInputLevel"))return"audio";if(-1!==e.stats.values.indexOf("googFrameRateReceived")||-1!==e.stats.values.indexOf("googFrameRateSent"))return"video"}return""}(t);if(""!==r&&(i.firstChild.firstChild.textContent+=" ("+r+")"),"ssrc"===t.type){const e=document.createElement("div");i.firstChild.appendChild(e),ssrcInfoManager.populateSsrcInfo(e,be(t))}}return i}(e,t),r=e.id+"-"+t.id+"-"+n,a=r+"-div",s=r+"-canvas",o=document.createElement("div");o.className="stats-graph-sub-container",i.appendChild(o);const c=ue("container-template").content.cloneNode(!0);return c.querySelectorAll("div")[0].textContent=n,c.querySelectorAll("div")[1].id=a,c.querySelector("canvas").id=s,o.appendChild(c),"bweCompound"===n&&o.insertBefore(function(e,t){const n=document.createElement("div");for(const i in He){const r=document.createElement("div");n.appendChild(r),r.appendChild(ue("checkbox-template").content.cloneNode(!0)),r.appendChild(document.createTextNode(i)),r.style.color=He[i].color,r.dataSeriesId=t+"-"+i,r.graphViewId=e.id+"-"+t+"-bweCompound",r.firstChild.addEventListener("click",(t=>{ge[e.id].getDataSeries(t.target.parentNode.dataSeriesId).show(t.target.checked),tt[t.target.parentNode.graphViewId].repaint()}))}return n}(e,t.id),ue(a)),new Ge(a,s)}const ct="user-media-tab-id",dt="Standardized (promise-based) getStats() API",lt="Legacy Non-Standard (callback-based) getStats() API";let pt,ht=dt,ut=null,mt=null,ft=null;window.setCurrentGetStatsMethod=e=>{ht=e},window.OPTION_GETSTATS_LEGACY=lt;const gt=new Map;function yt(e){return e.pid+"-"+e.lid}function Ct(e,t,n){var i=document.createElement(t);return i.textContent=n,e.appendChild(i),i}function vt(e,t){var n;pt.addPeerConnectionUpdate(e,t),"setLocalDescription"!=(n=t).type&&"setRemoteDescription"!=n.type||mt.addSsrcStreamInfo(n.value),ge[e.id].addUpdate(t)}function bt(e){const t=yt(e);ge[t]||(ge[t]=new _e),ge[t].initialize(e.pid,e.url,e.rtcConfiguration,e.constraints);let n=ue(t);if(!n){const i=`[ rid: ${e.rid}, lid: ${e.lid}, pid: ${e.pid} ]`;n=ut.addTab(t,e.url+" "+i)}const i=document.createElement("p");i.style.wordBreak="break-all",Ct(i,"span",e.url),Ct(i,"span",", "),Ct(i,"span",JSON.stringify(e.rtcConfiguration)),""!==e.constraints&&(Ct(i,"span",", "),Ct(i,"span",e.constraints)),n.appendChild(i);const r=document.createElement("ul");e.rtcConfiguration&&(r.className="peerconnection-deprecations"),e.constraints&&-1!==e.constraints.indexOf("enableDtlsSrtp:")&&(-1!==e.constraints.indexOf("enableDtlsSrtp: {exact: false}")?Ct(r,"li",'The constraint "DtlsSrtpKeyAgreement" will be removed. You have specified a "false" value for this constraint, which is interpreted as an attempt to use the deprecated "SDES" key negotiation method. This functionality will be removed; use a service that supports DTLS key negotiation instead.'):Ct(r,"li",'The constraint "DtlsSrtpKeyAgreement" will be removed. You have specified a "true" value for this constraint, which has no effect, but you can remove this constraint for tidiness.')),n.appendChild(r);const a=document.createElement("div");a.textContent="ICE connection state: new",a.className="iceconnectionstate",n.appendChild(a);const s=document.createElement("div");s.textContent="Connection state: new",s.className="connectionstate",n.appendChild(s);const o=document.createElement("div");o.textContent="Signaling state: new",o.className="signalingstate",n.appendChild(o);const c=document.createElement("div");return c.textContent="ICE Candidate pair: ",c.className="candidatepair",c.appendChild(document.createElement("span")),n.appendChild(c),function(e){const t=document.createElement("details");Ae(t,"summary","ICE candidate grid");const n=document.createElement("table");n.id="grid-"+e.id,n.className="candidategrid",t.appendChild(n);const i=document.createElement("tr");n.append(i),Ae(i,"th","Candidate (pair) id"),Ae(i,"th","State / Candidate type"),Ae(i,"th","Network type / address"),Ae(i,"th","Port"),Ae(i,"th","Protocol / candidate type"),Ae(i,"th","(Pair) Priority"),Ae(i,"th","Bytes sent / received"),Ae(i,"th","STUN requests sent / responses received"),Ae(i,"th","STUN requests received / responses sent"),Ae(i,"th","RTT"),Ae(i,"th","Last update"),e.appendChild(t)}(n),n}function St(e){if(ht!=dt)return;const t=ue(yt(e));if(!t)return;const n=yt(e);let i=gt.get(n);i||(i=new Oe,gt.set(n,i));const r=Pe.fromInternalsReportList(e.reports);i.addStatsReport(r),e.reports=i.currentReport.toInternalsReportList();for(let n=0;n<e.reports.length;++n){const i=e.reports[n];ft.addStatsReport(t,i),ae("open_graph")&&rt(t,i,!1)}const a=r.statsById;let s=null,o=null,c=null;a.forEach((e=>{"transport"!==e.type||s||(s=a.get(e.selectedCandidatePairId))}));const d=t.getElementsByClassName("candidatepair")[0].firstElementChild;if(s){s.remoteCandidateId&&(o=a.get(s.remoteCandidateId)),s.localCandidateId&&(c=a.get(s.localCandidateId)),c&&c.address&&-1!==c.address.indexOf(":")?d.innerText="["+c.address+"]:"+c.port+" <=> ["+o.address+"]:"+o.port:d.innerText=c.address+":"+c.port+" <=> "+o.address+":"+o.port;const e=document.getElementById(t.id+"-table-container"),i="stats-table-active-connection";e.childNodes.forEach((e=>{if("DETAILS"!==e.nodeName)return;const t=e.firstElementChild.innerText;t.startsWith(s.id)||t.startsWith(c.id)||t.startsWith(o.id)?e.firstElementChild.classList.add(i):e.firstElementChild.classList.remove(i)}));const r=t.getElementsByClassName("stats-graph-container");for(let e=0;e<r.length;e++){const t=r[e];"DETAILS"===t.nodeName&&(t.id.startsWith(n+"-candidate-pair")&&(t.id===n+"-candidate-pair-"+s.id+"-graph-container"?t.firstElementChild.classList.add(i):t.firstElementChild.classList.remove(i)))}}else d.innerText="(not connected)";!function(e,t){ue("grid-"+e.id).childNodes.forEach((e=>{e.classList.remove("candidategrid-active")}));let n=[];t.forEach((i=>{"transport"===i.type&&i.selectedCandidatePairId&&(n.push(i.selectedCandidatePairId),Be(e,!0,t.get(i.selectedCandidatePairId),t))})),t.forEach((i=>{"candidate-pair"!==i.type||n.includes(i.id)||Be(e,!1,i,t)}))}(t,r.statsById)}function Tt(e){if(ht!=lt)return;const t=ue(yt(e));if(t)for(let n=0;n<e.reports.length;++n){const i=e.reports[n];ft.addStatsReport(t,i),rt(t,i,!0)}}const _t=Math.random().toString(36).substr(2,10);function Rt(e,t,n){const i=location.href;let r={lid:t,pid:_t,type:e,time:Date.now()};switch(r.value=n,e){case"create":r.url=i,r.rtcConfiguration=n[0],r.constraints=JSON.stringify(n[1]),bt(r);break;case"navigator.mediaDevices.getUserMedia":case"navigator.getUserMedia":r={rid:0,pid:_t,origin:i,audio:JSON.stringify(n.audio),video:JSON.stringify(n.video),getUserMediaId:t},function(e){fe.push(e),ue(ct)||ut.addTab(ct,"GetUserMedia Requests");var t=document.createElement("div");t.className="user-media-request-div-class",t.rid=e.rid,ue(ct).appendChild(t),Ct(t,"div","Caller origin: "+e.origin),Ct(t,"div","Caller process id: "+e.pid),Ct(t,"span","Audio Constraints").style.fontWeight="bold",Ct(t,"div",e.audio),Ct(t,"span","Video Constraints").style.fontWeight="bold",Ct(t,"div",e.video)}(r);break;case"navigator.mediaDevices.getUserMediaOnSuccess":case"navigator.mediaDevices.getUserMediaOnFailure":case"navigator.getUserMediaOnSuccess":case"navigator.getUserMediaFailure":break;case"getStats":r.reports=[],Object.keys(n).forEach((function(e){var t=n[e],i=[];Object.keys(t).forEach((function(e){"timestamp"!==e&&(i.push(e),i.push(t[e]))})),r.reports.push({type:t.type,id:t.id,stats:{timestamp:t.timestamp,values:i}})})),-1===navigator.userAgent.indexOf("Edge")&&function(e){if(ue(yt(e)))for(var t=0;t<e.reports.length;++t)ht===dt?St(e):Tt(e)}(r);break;case"createOfferOnSuccess":case"setLocalDescription":case"setRemoteDescription":r.value="type: "+n.type+", sdp:\n"+n.sdp;default:vt(ue(yt(r)),r)}}function wt(e){return{id:e.id,tracks:e.getTracks().map((function(e){return{id:e.id,kind:e.kind,label:e.label,enabled:e.enabled,muted:e.muted,readyState:e.readyState}}))}}var Et,Pt;navigator.getUserMedia&&(Et=navigator.getUserMedia.bind(navigator),Pt=function(){var e=Math.random().toString(36).substr(2,10);Rt("getUserMedia",e,arguments[0]);var t=arguments[1],n=arguments[2];Et(arguments[0],(function(n){Rt("getUserMediaOnSuccess",e,wt(n)),t&&t(n)}),(function(t){Rt("getUserMediaOnFailure",e,t.name),n&&n(t)}))},navigator.getUserMedia=Pt.bind(navigator)),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(Et=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices),Pt=function(){var e=Math.random().toString(36).substr(2,10);return Rt("navigator.mediaDevices.getUserMedia",e,arguments[0]),Et.apply(navigator.mediaDevices,arguments).then((function(t){return Rt("navigator.mediaDevices.getUserMediaOnSuccess",e,wt(t)),t}),(function(t){return Rt("navigator.mediaDevices.getUserMediaOnFailure",e,t.name),Promise.reject(t)}))},navigator.mediaDevices.getUserMedia=Pt.bind(navigator.mediaDevices)),function(){const e=ue("content-root");null!==e&&(new ye(e),e.appendChild(function(){const e=ue("stats-template").content.cloneNode(!0),t=e.getElementById("statsSelectElement"),n=e.getElementById("legacy-stats-warning");return t.onchange=()=>{ht=t.value,n.style.display=ht===lt?"block":"none",Object.keys(ge).forEach((e=>{const t=ue(e);ft.clearStatsLists(t),function(e){const t=nt.get(e.id);if(t){for(let n=0;n<t.length;++n)e.removeChild(t[n]);nt.delete(e.id)}Object.keys(tt).forEach((t=>{t.startsWith(e.id)&&delete tt[t]}))}(t),ge[e].resetStats()}))},[dt].forEach((e=>{const n=document.createElement("option");n.setAttribute("value",e),n.appendChild(document.createTextNode(e)),t.appendChild(n)})),t.value=ht,e}()),ut=new ve(e),mt=new Se,pt=new me,ft=new Te(mt),function(){let e=0;const t=window.RTCPeerConnection;if(!t)throw new Error("cannot find RTCPeerConnection in window");window.RTCPeerConnection=function(){const n=new t(arguments[0],arguments[1]);return n._id=e++,Rt("create",n._id,arguments),n.addEventListener("icecandidate",(function(e){Rt("icecandidate",n._id,e.candidate)})),n.addEventListener("addstream",(function(e){Rt("onaddstream",n._id,e.stream.id+" "+e.stream.getTracks().map((function(e){return e.kind+":"+e.id})))})),n.addEventListener("removestream",(function(e){Rt("onremovestream",n._id,e.stream.id+" "+e.stream.getTracks().map((function(e){return e.kind+":"+e.id})))})),n.addEventListener("track",(function(e){Rt("ontrack",n._id,e.track.kind+":"+e.track.id+" "+e.streams.map((function(e){return"stream:"+e.id})))})),n.addEventListener("signalingstatechange",(function(){Rt("signalingstatechange",n._id,n.signalingState)})),n.addEventListener("iceconnectionstatechange",(function(){Rt("iceconnectionstatechange",n._id,n.iceConnectionState)})),n.addEventListener("connectionstatechange",(function(){Rt("connectionstatechange",n._id,n.connectionState)})),n.addEventListener("icegatheringstatechange",(function(){Rt("onicegatheringstatechange",n._id,n.iceGatheringState)})),n.addEventListener("negotiationneeded",(function(){Rt("onnegotiationneeded",n._id,{})})),n.addEventListener("datachannel",(function(e){Rt("ondatachannel",n._id,[e.channel.id,e.channel.label])})),window.setTimeout((function e(){"closed"!==n.connectionState?window.setTimeout(e,ae("stats_update_interval")):Rt("connectionstatechange",n._id,n.connectionState),n.getStats().then((function(e){Rt("getStats",n._id,function(e){if(!e.entries)return e;var t={};return e.forEach((function(e,n){t[n]=e})),t}(e))}))}),ae("stats_update_interval")),n},window.RTCPeerConnection.prototype=t.prototype,["createOffer","createAnswer"].forEach((function(e){var t=window.RTCPeerConnection.prototype[e];t&&(window.RTCPeerConnection.prototype[e]=function(){var n,i=this,r=arguments;return 1===arguments.length&&"object"==typeof arguments[0]?n=arguments[0]:3===arguments.length&&"object"==typeof arguments[2]&&(n=arguments[2]),Rt(e,i._id,n),new Promise((function(a,s){t.apply(i,[function(t){Rt(e+"OnSuccess",i._id,t),a(t),r.length>0&&"function"==typeof r[0]&&r[0].apply(null,[t])},function(t){Rt(e+"OnFailure",i._id,t.toString()),s(t),r.length>1&&"function"==typeof r[1]&&r[1].apply(null,[t])},n])}))})})),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(e){var t=window.RTCPeerConnection.prototype[e];t&&(window.RTCPeerConnection.prototype[e]=function(){var n=this,i=arguments;return Rt(e,n._id,i[0]),new Promise((function(r,a){t.apply(n,[i[0],function(){Rt(e+"OnSuccess",n._id),r(),i.length>=2&&i[1].apply(null,[])},function(t){Rt(e+"OnFailure",n._id,t.toString()),a(t),i.length>=3&&i[2].apply(null,[t])}])}))})})),["addStream","removeStream"].forEach((function(e){var t=window.RTCPeerConnection.prototype[e];t&&(window.RTCPeerConnection.prototype[e]=function(){var n=this,i=arguments[0],r=i.getTracks().map((function(e){return e.kind+":"+e.id}));return Rt(e,n._id,i.id+" "+r),t.apply(n,arguments)})})),["addTrack"].forEach((function(e){var t=window.RTCPeerConnection.prototype[e];t&&(window.RTCPeerConnection.prototype[e]=function(){var n=this,i=arguments[0],r=[].slice.call(arguments,1);Rt(e,n._id,i.kind+":"+i.id+" "+(r.map((function(e){return"stream:"+e.id})).join(";")||"-"));var a=t.apply(n,arguments);if(a&&a.replaceTrack){var s=a.replaceTrack;a.replaceTrack=function(e){return Rt("replaceTrack",n._id,(a.track?a.track.kind+":"+a.track.id:"null")+" with "+(e?e.kind+":"+e.id:"null")),s.apply(a,arguments)}}return a})})),["removeTrack"].forEach((function(e){var t=window.RTCPeerConnection.prototype[e];t&&(window.RTCPeerConnection.prototype[e]=function(){var n=this,i=arguments[0].track;return Rt(e,n._id,i?i.kind+":"+i.id:"null"),t.apply(n,arguments)})})),["close","createDataChannel"].forEach((function(e){var t=window.RTCPeerConnection.prototype[e];t&&(window.RTCPeerConnection.prototype[e]=function(){var n=this;return Rt(e,n._id,arguments),t.apply(n,arguments)})})),["addTransceiver"].forEach((function(e){const t=window.RTCPeerConnection.prototype[e];t&&(window.RTCPeerConnection.prototype[e]=function(){const e=this,n=arguments[0]instanceof MediaStreamTrack?arguments[0].kind:arguments[0],i=t.apply(e,arguments),r=`\n        Caused by: addTransceiver\n\n        getTransceivers()[${e.getTransceivers().length-1}]:{\n          mid: ${i.mid},\n          kind:${n},\n          sender: {\n            track: ${i.sender.track?.id},\n          },\n          receiver: {\n            track: ${i.receiver.track?.id},\n          },\n          direction: ${i.direction},\n          currentDirection: ${i.currentDirection},\n        }\n        `;return Rt("transceiverAdded",e._id,r),i})}))}())}()}));
